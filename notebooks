{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 16,
   "id": "4e3a18b1",
   "metadata": {},
   "outputs": [],
   "source": [
    "import os\n",
    "import joblib \n",
    "import pandas as pd\n",
    "import numpy as np\n",
    "import matplotlib.pyplot as plt\n",
    "import seaborn as sns\n",
    "from sklearn.model_selection import StratifiedShuffleSplit\n",
    "from sklearn.pipeline import Pipeline\n",
    "from sklearn.compose import ColumnTransformer\n",
    "from sklearn.impute import SimpleImputer\n",
    "from sklearn.preprocessing import StandardScaler, OneHotEncoder\n",
    "from sklearn.ensemble import RandomForestRegressor"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "09221ac2",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "<class 'pandas.core.frame.DataFrame'>\n",
      "RangeIndex: 100000 entries, 0 to 99999\n",
      "Data columns (total 24 columns):\n",
      " #   Column                  Non-Null Count   Dtype  \n",
      "---  ------                  --------------   -----  \n",
      " 0   Index                   100000 non-null  int64  \n",
      " 1   pH                      97979 non-null   float64\n",
      " 2   Iron                    99328 non-null   float64\n",
      " 3   Nitrate                 98204 non-null   float64\n",
      " 4   Chloride                97045 non-null   float64\n",
      " 5   Lead                    99571 non-null   float64\n",
      " 6   Zinc                    97439 non-null   float64\n",
      " 7   Color                   99901 non-null   object \n",
      " 8   Turbidity               99167 non-null   float64\n",
      " 9   Fluoride                96784 non-null   float64\n",
      " 10  Copper                  96785 non-null   float64\n",
      " 11  Odor                    97034 non-null   float64\n",
      " 12  Sulfate                 96723 non-null   float64\n",
      " 13  Conductivity            97215 non-null   float64\n",
      " 14  Chlorine                98992 non-null   float64\n",
      " 15  Manganese               98170 non-null   float64\n",
      " 16  Total Dissolved Solids  99961 non-null   float64\n",
      " 17  Source                  98471 non-null   object \n",
      " 18  Water Temperature       97190 non-null   float64\n",
      " 19  Air Temperature         99521 non-null   float64\n",
      " 20  Month                   98377 non-null   object \n",
      " 21  Day                     98309 non-null   float64\n",
      " 22  Time of Day             98064 non-null   float64\n",
      " 23  Target                  100000 non-null  int64  \n",
      "dtypes: float64(19), int64(2), object(3)\n",
      "memory usage: 18.3+ MB\n"
     ]
    }
   ],
   "source": [
    "# Load data\n",
    "data= pd.read_csv(\"water_quality_dataset_100k_new.csv\")\n",
    "\n",
    "# Basic info\n",
    "data.info()\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "931273ce",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Index</th>\n",
       "      <th>pH</th>\n",
       "      <th>Iron</th>\n",
       "      <th>Nitrate</th>\n",
       "      <th>Chloride</th>\n",
       "      <th>Lead</th>\n",
       "      <th>Zinc</th>\n",
       "      <th>Color</th>\n",
       "      <th>Turbidity</th>\n",
       "      <th>Fluoride</th>\n",
       "      <th>...</th>\n",
       "      <th>Chlorine</th>\n",
       "      <th>Manganese</th>\n",
       "      <th>Total Dissolved Solids</th>\n",
       "      <th>Source</th>\n",
       "      <th>Water Temperature</th>\n",
       "      <th>Air Temperature</th>\n",
       "      <th>Month</th>\n",
       "      <th>Day</th>\n",
       "      <th>Time of Day</th>\n",
       "      <th>Target</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>3343584</td>\n",
       "      <td>7.262136</td>\n",
       "      <td>0.002857</td>\n",
       "      <td>5.965704</td>\n",
       "      <td>245.101184</td>\n",
       "      <td>6.679537e-44</td>\n",
       "      <td>0.702867</td>\n",
       "      <td>Faint Yellow</td>\n",
       "      <td>0.014223</td>\n",
       "      <td>0.583591</td>\n",
       "      <td>...</td>\n",
       "      <td>2.835370</td>\n",
       "      <td>8.067879e-03</td>\n",
       "      <td>153.126744</td>\n",
       "      <td>Spring</td>\n",
       "      <td>11.179752</td>\n",
       "      <td>55.340114</td>\n",
       "      <td>August</td>\n",
       "      <td>20.0</td>\n",
       "      <td>17.0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>4332797</td>\n",
       "      <td>6.827967</td>\n",
       "      <td>0.000356</td>\n",
       "      <td>8.650092</td>\n",
       "      <td>261.948686</td>\n",
       "      <td>2.751868e-159</td>\n",
       "      <td>0.205934</td>\n",
       "      <td>Colorless</td>\n",
       "      <td>0.339881</td>\n",
       "      <td>2.214786</td>\n",
       "      <td>...</td>\n",
       "      <td>3.228036</td>\n",
       "      <td>4.245956e-05</td>\n",
       "      <td>260.391845</td>\n",
       "      <td>Ground</td>\n",
       "      <td>12.573723</td>\n",
       "      <td>80.335206</td>\n",
       "      <td>June</td>\n",
       "      <td>26.0</td>\n",
       "      <td>2.0</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>2580354</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0.000063</td>\n",
       "      <td>NaN</td>\n",
       "      <td>176.192348</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0.896104</td>\n",
       "      <td>Near Colorless</td>\n",
       "      <td>0.122076</td>\n",
       "      <td>1.566183</td>\n",
       "      <td>...</td>\n",
       "      <td>2.863932</td>\n",
       "      <td>1.646600e-03</td>\n",
       "      <td>131.984171</td>\n",
       "      <td>Reservoir</td>\n",
       "      <td>12.702576</td>\n",
       "      <td>81.535521</td>\n",
       "      <td>January</td>\n",
       "      <td>4.0</td>\n",
       "      <td>16.0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>484305</td>\n",
       "      <td>7.782600</td>\n",
       "      <td>0.051721</td>\n",
       "      <td>3.747001</td>\n",
       "      <td>224.053938</td>\n",
       "      <td>1.513023e-136</td>\n",
       "      <td>0.088500</td>\n",
       "      <td>Colorless</td>\n",
       "      <td>0.209460</td>\n",
       "      <td>0.693032</td>\n",
       "      <td>...</td>\n",
       "      <td>4.195383</td>\n",
       "      <td>5.283502e-11</td>\n",
       "      <td>447.051626</td>\n",
       "      <td>NaN</td>\n",
       "      <td>13.009862</td>\n",
       "      <td>72.845282</td>\n",
       "      <td>May</td>\n",
       "      <td>13.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>1026518</td>\n",
       "      <td>7.627800</td>\n",
       "      <td>0.000172</td>\n",
       "      <td>7.988966</td>\n",
       "      <td>89.478315</td>\n",
       "      <td>3.450032e-76</td>\n",
       "      <td>0.402281</td>\n",
       "      <td>Colorless</td>\n",
       "      <td>0.520102</td>\n",
       "      <td>1.130603</td>\n",
       "      <td>...</td>\n",
       "      <td>4.004640</td>\n",
       "      <td>9.799640e-03</td>\n",
       "      <td>395.187898</td>\n",
       "      <td>Ground</td>\n",
       "      <td>17.727374</td>\n",
       "      <td>36.844691</td>\n",
       "      <td>December</td>\n",
       "      <td>25.0</td>\n",
       "      <td>18.0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>5 rows Ã— 24 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "     Index        pH      Iron   Nitrate    Chloride           Lead      Zinc  \\\n",
       "0  3343584  7.262136  0.002857  5.965704  245.101184   6.679537e-44  0.702867   \n",
       "1  4332797  6.827967  0.000356  8.650092  261.948686  2.751868e-159  0.205934   \n",
       "2  2580354       NaN  0.000063       NaN  176.192348            NaN  0.896104   \n",
       "3   484305  7.782600  0.051721  3.747001  224.053938  1.513023e-136  0.088500   \n",
       "4  1026518  7.627800  0.000172  7.988966   89.478315   3.450032e-76  0.402281   \n",
       "\n",
       "            Color  Turbidity  Fluoride  ...  Chlorine     Manganese  \\\n",
       "0    Faint Yellow   0.014223  0.583591  ...  2.835370  8.067879e-03   \n",
       "1       Colorless   0.339881  2.214786  ...  3.228036  4.245956e-05   \n",
       "2  Near Colorless   0.122076  1.566183  ...  2.863932  1.646600e-03   \n",
       "3       Colorless   0.209460  0.693032  ...  4.195383  5.283502e-11   \n",
       "4       Colorless   0.520102  1.130603  ...  4.004640  9.799640e-03   \n",
       "\n",
       "   Total Dissolved Solids     Source  Water Temperature  Air Temperature  \\\n",
       "0              153.126744     Spring          11.179752        55.340114   \n",
       "1              260.391845     Ground          12.573723        80.335206   \n",
       "2              131.984171  Reservoir          12.702576        81.535521   \n",
       "3              447.051626        NaN          13.009862        72.845282   \n",
       "4              395.187898     Ground          17.727374        36.844691   \n",
       "\n",
       "      Month   Day  Time of Day  Target  \n",
       "0    August  20.0         17.0       0  \n",
       "1      June  26.0          2.0       1  \n",
       "2   January   4.0         16.0       0  \n",
       "3       May  13.0          1.0       0  \n",
       "4  December  25.0         18.0       0  \n",
       "\n",
       "[5 rows x 24 columns]"
      ]
     },
     "execution_count": 9,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "data.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "19e1480c",
   "metadata": {},
   "outputs": [],
   "source": [
    "data = data.drop(columns=[\"Index\"])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "5b86d450",
   "metadata": {},
   "outputs": [],
   "source": [
    "df=data.copy()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "cdc943f5",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>pH</th>\n",
       "      <th>Iron</th>\n",
       "      <th>Nitrate</th>\n",
       "      <th>Chloride</th>\n",
       "      <th>Lead</th>\n",
       "      <th>Zinc</th>\n",
       "      <th>Color</th>\n",
       "      <th>Turbidity</th>\n",
       "      <th>Fluoride</th>\n",
       "      <th>Copper</th>\n",
       "      <th>...</th>\n",
       "      <th>Chlorine</th>\n",
       "      <th>Manganese</th>\n",
       "      <th>Total Dissolved Solids</th>\n",
       "      <th>Source</th>\n",
       "      <th>Water Temperature</th>\n",
       "      <th>Air Temperature</th>\n",
       "      <th>Month</th>\n",
       "      <th>Day</th>\n",
       "      <th>Time of Day</th>\n",
       "      <th>Target</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>7.262136</td>\n",
       "      <td>2.857248e-03</td>\n",
       "      <td>5.965704</td>\n",
       "      <td>245.101184</td>\n",
       "      <td>6.679537e-44</td>\n",
       "      <td>0.702867</td>\n",
       "      <td>Faint Yellow</td>\n",
       "      <td>0.014223</td>\n",
       "      <td>0.583591</td>\n",
       "      <td>0.039819</td>\n",
       "      <td>...</td>\n",
       "      <td>2.835370</td>\n",
       "      <td>8.067879e-03</td>\n",
       "      <td>153.126744</td>\n",
       "      <td>Spring</td>\n",
       "      <td>11.179752</td>\n",
       "      <td>55.340114</td>\n",
       "      <td>August</td>\n",
       "      <td>20.0</td>\n",
       "      <td>17.0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>6.827967</td>\n",
       "      <td>3.555528e-04</td>\n",
       "      <td>8.650092</td>\n",
       "      <td>261.948686</td>\n",
       "      <td>2.751868e-159</td>\n",
       "      <td>0.205934</td>\n",
       "      <td>Colorless</td>\n",
       "      <td>0.339881</td>\n",
       "      <td>2.214786</td>\n",
       "      <td>0.224705</td>\n",
       "      <td>...</td>\n",
       "      <td>3.228036</td>\n",
       "      <td>4.245956e-05</td>\n",
       "      <td>260.391845</td>\n",
       "      <td>Ground</td>\n",
       "      <td>12.573723</td>\n",
       "      <td>80.335206</td>\n",
       "      <td>June</td>\n",
       "      <td>26.0</td>\n",
       "      <td>2.0</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>NaN</td>\n",
       "      <td>6.303493e-05</td>\n",
       "      <td>NaN</td>\n",
       "      <td>176.192348</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0.896104</td>\n",
       "      <td>Near Colorless</td>\n",
       "      <td>0.122076</td>\n",
       "      <td>1.566183</td>\n",
       "      <td>0.058934</td>\n",
       "      <td>...</td>\n",
       "      <td>2.863932</td>\n",
       "      <td>1.646600e-03</td>\n",
       "      <td>131.984171</td>\n",
       "      <td>Reservoir</td>\n",
       "      <td>12.702576</td>\n",
       "      <td>81.535521</td>\n",
       "      <td>January</td>\n",
       "      <td>4.0</td>\n",
       "      <td>16.0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>7.782600</td>\n",
       "      <td>5.172140e-02</td>\n",
       "      <td>3.747001</td>\n",
       "      <td>224.053938</td>\n",
       "      <td>1.513023e-136</td>\n",
       "      <td>0.088500</td>\n",
       "      <td>Colorless</td>\n",
       "      <td>0.209460</td>\n",
       "      <td>0.693032</td>\n",
       "      <td>0.393710</td>\n",
       "      <td>...</td>\n",
       "      <td>4.195383</td>\n",
       "      <td>5.283502e-11</td>\n",
       "      <td>447.051626</td>\n",
       "      <td>NaN</td>\n",
       "      <td>13.009862</td>\n",
       "      <td>72.845282</td>\n",
       "      <td>May</td>\n",
       "      <td>13.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>7.627800</td>\n",
       "      <td>1.721911e-04</td>\n",
       "      <td>7.988966</td>\n",
       "      <td>89.478315</td>\n",
       "      <td>3.450032e-76</td>\n",
       "      <td>0.402281</td>\n",
       "      <td>Colorless</td>\n",
       "      <td>0.520102</td>\n",
       "      <td>1.130603</td>\n",
       "      <td>0.211742</td>\n",
       "      <td>...</td>\n",
       "      <td>4.004640</td>\n",
       "      <td>9.799640e-03</td>\n",
       "      <td>395.187898</td>\n",
       "      <td>Ground</td>\n",
       "      <td>17.727374</td>\n",
       "      <td>36.844691</td>\n",
       "      <td>December</td>\n",
       "      <td>25.0</td>\n",
       "      <td>18.0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>99995</th>\n",
       "      <td>6.878051</td>\n",
       "      <td>4.117124e-07</td>\n",
       "      <td>5.322810</td>\n",
       "      <td>108.110638</td>\n",
       "      <td>8.696207e-159</td>\n",
       "      <td>3.182844</td>\n",
       "      <td>Colorless</td>\n",
       "      <td>0.278222</td>\n",
       "      <td>1.282346</td>\n",
       "      <td>0.759200</td>\n",
       "      <td>...</td>\n",
       "      <td>3.844900</td>\n",
       "      <td>3.612888e-03</td>\n",
       "      <td>490.345588</td>\n",
       "      <td>Lake</td>\n",
       "      <td>9.796617</td>\n",
       "      <td>38.218949</td>\n",
       "      <td>May</td>\n",
       "      <td>21.0</td>\n",
       "      <td>7.0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>99996</th>\n",
       "      <td>6.234022</td>\n",
       "      <td>1.117469e-01</td>\n",
       "      <td>17.328060</td>\n",
       "      <td>419.511947</td>\n",
       "      <td>3.996521e-146</td>\n",
       "      <td>0.279021</td>\n",
       "      <td>Yellow</td>\n",
       "      <td>0.152766</td>\n",
       "      <td>1.119400</td>\n",
       "      <td>1.501363</td>\n",
       "      <td>...</td>\n",
       "      <td>2.896578</td>\n",
       "      <td>3.589283e-03</td>\n",
       "      <td>355.272379</td>\n",
       "      <td>Well</td>\n",
       "      <td>15.855275</td>\n",
       "      <td>63.903902</td>\n",
       "      <td>March</td>\n",
       "      <td>18.0</td>\n",
       "      <td>12.0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>99997</th>\n",
       "      <td>7.861995</td>\n",
       "      <td>3.820164e-05</td>\n",
       "      <td>4.304552</td>\n",
       "      <td>215.233572</td>\n",
       "      <td>2.909526e-124</td>\n",
       "      <td>0.009500</td>\n",
       "      <td>Near Colorless</td>\n",
       "      <td>0.027866</td>\n",
       "      <td>0.093040</td>\n",
       "      <td>0.277302</td>\n",
       "      <td>...</td>\n",
       "      <td>2.131950</td>\n",
       "      <td>1.754100e-03</td>\n",
       "      <td>337.180755</td>\n",
       "      <td>River</td>\n",
       "      <td>37.648185</td>\n",
       "      <td>72.763230</td>\n",
       "      <td>May</td>\n",
       "      <td>15.0</td>\n",
       "      <td>12.0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "
